{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/joshyorko/room-of-requirement/schemas/feature-manifest.schema.json",
  "title": "Room of Requirement DevContainer Feature Manifest",
  "description": "Schema for devcontainer-feature.json files in the RoR ecosystem",
  "type": "object",
  "required": ["id", "version", "name"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9][a-z0-9-]*[a-z0-9]$",
      "description": "Unique feature identifier (lowercase alphanumeric with hyphens)",
      "examples": ["mise", "starship", "ror-core"]
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$",
      "description": "Semantic version of the feature",
      "examples": ["1.0.0", "2.1.0-beta.1"]
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100,
      "description": "Human-readable feature name"
    },
    "description": {
      "type": "string",
      "maxLength": 500,
      "description": "Brief description of the feature"
    },
    "documentationURL": {
      "type": "string",
      "format": "uri",
      "description": "URL to feature documentation"
    },
    "licenseURL": {
      "type": "string",
      "format": "uri",
      "description": "URL to license file"
    },
    "options": {
      "type": "object",
      "description": "User-configurable installation options",
      "additionalProperties": {
        "$ref": "#/definitions/option"
      }
    },
    "dependsOn": {
      "type": "object",
      "description": "Features this Meta-Feature depends on (hard dependencies)",
      "additionalProperties": {
        "type": "object",
        "description": "Options to pass to the dependent feature"
      }
    },
    "installsAfter": {
      "type": "array",
      "items": {
        "type": "string",
        "format": "uri"
      },
      "description": "Features that should install before this one (soft ordering)"
    },
    "containerEnv": {
      "type": "object",
      "additionalProperties": {
        "type": "string"
      },
      "description": "Environment variables to set in the container"
    },
    "privileged": {
      "type": "boolean",
      "default": false,
      "description": "Whether the feature requires privileged mode"
    },
    "init": {
      "type": "boolean",
      "default": false,
      "description": "Whether to run an init process"
    },
    "capAdd": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Linux capabilities to add"
    },
    "securityOpt": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Security options"
    },
    "entrypoint": {
      "type": "string",
      "description": "Override container entrypoint"
    },
    "mounts": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/mount"
      },
      "description": "Volume mounts"
    },
    "customizations": {
      "type": "object",
      "description": "Tool-specific customizations (e.g., VS Code settings)"
    },
    "onCreateCommand": {
      "$ref": "#/definitions/command",
      "description": "Command to run during container creation"
    },
    "updateContentCommand": {
      "$ref": "#/definitions/command",
      "description": "Command to run when content is updated"
    },
    "postCreateCommand": {
      "$ref": "#/definitions/command",
      "description": "Command to run after container creation"
    },
    "postStartCommand": {
      "$ref": "#/definitions/command",
      "description": "Command to run after container starts"
    },
    "postAttachCommand": {
      "$ref": "#/definitions/command",
      "description": "Command to run after attaching to container"
    }
  },
  "definitions": {
    "option": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["boolean", "string", "enum"],
          "description": "Option data type"
        },
        "default": {
          "description": "Default value for the option"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description"
        },
        "enum": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Allowed values (for enum type)"
        },
        "proposals": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Suggested values for the option"
        }
      }
    },
    "mount": {
      "type": "object",
      "required": ["type", "source", "target"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["bind", "volume"]
        },
        "source": {
          "type": "string"
        },
        "target": {
          "type": "string"
        }
      }
    },
    "command": {
      "oneOf": [
        { "type": "string" },
        {
          "type": "array",
          "items": { "type": "string" }
        },
        {
          "type": "object",
          "additionalProperties": {
            "oneOf": [
              { "type": "string" },
              { "type": "array", "items": { "type": "string" } }
            ]
          }
        }
      ]
    }
  }
}
