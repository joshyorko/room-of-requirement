{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/joshyorko/room-of-requirement/schemas/maintenance-allowlist.schema.json",
  "title": "Maintenance Robot Allowlist",
  "description": "Schema for allowlist files used by the RCC maintenance robot",
  "type": "object",
  "required": ["version", "items"],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+$",
      "description": "Schema version"
    },
    "items": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/allowlistItem"
      },
      "description": "List of allowed items"
    }
  },
  "definitions": {
    "allowlistItem": {
      "type": "object",
      "required": ["name", "type"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Item identifier"
        },
        "type": {
          "type": "string",
          "enum": ["github_release", "wolfi_package", "direct_url", "github_action"],
          "description": "Item type for version resolution"
        },
        "repo": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9_.-]+/[a-zA-Z0-9_.-]+$",
          "description": "GitHub repository (owner/repo)"
        },
        "package": {
          "type": "string",
          "description": "Wolfi package name"
        },
        "url_pattern": {
          "type": "string",
          "description": "URL pattern with {version} placeholder"
        },
        "version_regex": {
          "type": "string",
          "description": "Regex to extract version from URL or filename"
        },
        "max_major": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum allowed major version"
        },
        "min_version": {
          "type": "string",
          "description": "Minimum allowed version"
        },
        "exclude_prerelease": {
          "type": "boolean",
          "default": true,
          "description": "Exclude pre-release versions"
        },
        "sha256_required": {
          "type": "boolean",
          "default": true,
          "description": "Require SHA256 checksum verification"
        },
        "architectures": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["amd64", "arm64"]
          },
          "default": ["amd64"],
          "description": "Supported architectures"
        },
        "dockerfile_arg": {
          "type": "string",
          "description": "Dockerfile ARG name for version"
        },
        "sha256_arg": {
          "type": "string",
          "description": "Dockerfile ARG name for SHA256"
        },
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Whether this item is actively maintained"
        }
      }
    }
  }
}
