# Build Workflow Input Contracts
# Defines the expected inputs for CI/CD workflows

---
# Image Build Workflow
workflow: build-image.yml
description: Build, sign, and publish the pre-built ror image
inputs:
  push:
    type: boolean
    default: false
    description: Whether to push the built image to registry

  platforms:
    type: string
    default: linux/amd64
    description: Target platforms (comma-separated)

  tags:
    type: string
    default: latest
    description: Image tags (comma-separated)

  sign:
    type: boolean
    default: true
    description: Sign image with Cosign

  generate_sbom:
    type: boolean
    default: true
    description: Generate and attach SBOM

  scan_cve:
    type: boolean
    default: true
    description: Run CVE vulnerability scan

  fail_on_critical:
    type: boolean
    default: true
    description: Fail build on Critical CVEs with fixes

outputs:
  image_digest:
    type: string
    description: SHA256 digest of the built image

  image_tags:
    type: array
    description: List of tags applied to the image

  sbom_digest:
    type: string
    description: SHA256 digest of the SBOM attestation

  cve_count:
    type: object
    properties:
      critical: { type: integer }
      high: { type: integer }
      medium: { type: integer }
      low: { type: integer }

---
# Feature Build Workflow
workflow: build-features.yml
description: Build and publish DevContainer Features
inputs:
  features:
    type: array
    items:
      type: string
    default: []
    description: Specific features to build (empty = all)

  publish:
    type: boolean
    default: false
    description: Publish features to GHCR

  generate_docs:
    type: boolean
    default: true
    description: Generate README files for features

  dry_run:
    type: boolean
    default: false
    description: Validate without building

outputs:
  published_features:
    type: array
    items:
      type: object
      properties:
        id: { type: string }
        version: { type: string }
        digest: { type: string }
        uri: { type: string }

---
# Template Build Workflow
workflow: build-templates.yml
description: Build and publish DevContainer Templates
inputs:
  templates:
    type: array
    items:
      type: string
    default: []
    description: Specific templates to build (empty = all)

  publish:
    type: boolean
    default: false
    description: Publish templates to GHCR

  generate_docs:
    type: boolean
    default: true
    description: Generate README files for templates

outputs:
  published_templates:
    type: array
    items:
      type: object
      properties:
        id: { type: string }
        version: { type: string }
        uri: { type: string }

---
# Maintenance Workflow
workflow: rcc-maintenance.yml
description: Run automated maintenance tasks
inputs:
  task:
    type: string
    enum:
      - maintenance
      - update-workflows
      - update-downloads
      - update-features
    default: maintenance
    description: Maintenance task to run

  dry_run:
    type: boolean
    default: false
    description: Preview changes without committing

  create_pr:
    type: boolean
    default: true
    description: Create PR for changes

outputs:
  changes_detected:
    type: boolean
    description: Whether any updates were found

  updates:
    type: array
    items:
      type: object
      properties:
        item: { type: string }
        from_version: { type: string }
        to_version: { type: string }

  pr_url:
    type: string
    description: URL of created PR (if applicable)
